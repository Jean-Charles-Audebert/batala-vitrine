<%
  // Composant Content Section (Actus / Offres)
  // Variables attendues: contentBlock, user
  const bgStyle = contentBlock.bg_image ? `background-image: url(${contentBlock.bg_image})` : '';
  const sectionLabel = contentBlock.type === 'events' ? 'Section des événements' : 'Section des offres';
%>

<section 
  class="block-section" 
  id="<%= contentBlock.slug %>" 
  data-block-id="<%= contentBlock.id %>" 
  style="<%= bgStyle %>"
  aria-labelledby="section-title-<%= contentBlock.id %>"
>
  <div class="container">
    <div class="section-header">
      <h2 id="section-title-<%= contentBlock.id %>"><%= contentBlock.title %></h2>
      <% if (user) { %>
        <%-
          include('icon-button', {
            type: 'button',
            className: 'add-card-btn',
            icon: 'plus',
            ariaLabel: `Ajouter une nouvelle carte dans ${contentBlock.title}`,
            dataAttrs: { 'data-block-id': contentBlock.id }
          })
        %>
      <% } %>
    </div>
    
    <div class="cards-grid" role="list" aria-label="<%= sectionLabel %>">
      <% (contentBlock.cards || []).forEach(card => { %>
        <article class="card" data-card-id="<%= card.id %>" role="listitem">
          <% if (card.media_path) { %>
            <img 
              src="<%= card.media_path %>" 
              alt="<%= card.title %> - <%= card.description ? card.description.substring(0, 100) : 'Illustration' %>"
              loading="lazy"
            >
          <% } %>
          <h3><%= card.title %></h3>
          <% if (card.description) { %>
            <p><%= card.description %></p>
          <% } %>
          <% if (user) { %>
            <div class="card-controls" role="toolbar" aria-label="Actions pour <%= card.title %>">
              <%-
                include('icon-button', {
                  type: 'button',
                  className: 'edit-card-btn',
                  icon: 'edit',
                  ariaLabel: `Modifier la carte ${card.title}`,
                  dataAttrs: { 'data-card-id': card.id }
                })
              %>
              <%-
                include('icon-button', {
                  type: 'button',
                  className: 'delete-card-btn',
                  icon: 'trash',
                  ariaLabel: `Supprimer la carte ${card.title}`,
                  dataAttrs: { 'data-card-id': card.id }
                })
              %>
            </div>
          <% } %>
        </article>
      <% }) %>
    </div>
  </div>
</section>
