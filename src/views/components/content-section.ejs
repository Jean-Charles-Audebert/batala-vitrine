<%
  // Composant Content Section (Actus / Offres)
  // Variables attendues: contentBlock, user
  const bgStyle = contentBlock.bg_image ? `background-image: url(${contentBlock.bg_image})` : '';
  const sectionLabel = contentBlock.type === 'events' ? 'Section des événements' : 'Section des offres';
%>

<section 
  class="block-section" 
  id="<%= contentBlock.slug %>" 
  data-block-id="<%= contentBlock.id %>"
  data-transparent="<%= contentBlock.is_transparent ? 'true' : 'false' %>"
  <% if (contentBlock.bg_color) { %>
  style="background-color: <%= contentBlock.bg_color %>; <%= bgStyle %>"
  <% } else { %>
  style="<%= bgStyle %>"
  <% } %>
  aria-labelledby="section-title-<%= contentBlock.id %>"
>
  <div class="container">
    <div class="section-header">
      <h2 
        class="section-title"
        id="section-title-<%= contentBlock.id %>"
        <% if (contentBlock.title_font || contentBlock.title_color) { %>
        style="<%= contentBlock.title_font ? `font-family: ${contentBlock.title_font};` : '' %> <%= contentBlock.title_color ? `color: ${contentBlock.title_color};` : '' %>"
        <% } %>
      ><%= contentBlock.title %></h2>
      <% if (user) { %>
        <%-
          include('icon-button', {
            type: 'button',
            className: 'add-card-btn',
            icon: 'plus',
            ariaLabel: `Ajouter une nouvelle carte dans ${contentBlock.title}`,
            dataAttrs: { 'data-block-id': contentBlock.id }
          })
        %>
      <% } %>
    </div>
    
    <div class="cards-grid" role="list" aria-label="<%= sectionLabel %>">
      <% (contentBlock.cards || []).forEach(card => { %>
        <%
          // Sélectionner le template de card approprié
          const template = card.template || 'default';
          const templateMap = {
            'default': 'cards/card-default',
            'image_left': 'cards/card-image-left',
            'image_right': 'cards/card-image-right',
            'photo': 'cards/card-photo',
            'video': 'cards/card-video',
            'text_only': 'cards/card-text-only'
          };
          const templatePath = templateMap[template] || 'cards/card-default';
        %>
        <%- include(templatePath, { card, user }) %>
      <% }) %>
    </div>
  </div>
</section>
