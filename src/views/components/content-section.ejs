<%
  // Composant Content Section (Actus / Offres)
  // Variables attendues: contentBlock, user
  const bgStyle = contentBlock.bg_image ? `background-image: url(${contentBlock.bg_image})` : '';
  const sectionLabel = contentBlock.type === 'events' ? 'Section des événements' : 'Section des offres';
%>

<section 
  class="block-section" 
  id="<%= contentBlock.slug %>" 
  data-block-id="<%= contentBlock.id %>"
  data-transparent="<%= contentBlock.is_transparent ? 'true' : 'false' %>"
  <% if (contentBlock.bg_color) { %>
  style="background-color: <%= contentBlock.bg_color %>; <%= bgStyle %>"
  <% } else { %>
  style="<%= bgStyle %>"
  <% } %>
  aria-labelledby="section-title-<%= contentBlock.id %>"
>
  <div class="container">
    <div class="section-header">
      <h2 
        class="section-title"
        id="section-title-<%= contentBlock.id %>"
        <% if (contentBlock.title_font || contentBlock.title_color) { %>
        style="<%= contentBlock.title_font ? `font-family: ${contentBlock.title_font};` : '' %> <%= contentBlock.title_color ? `color: ${contentBlock.title_color};` : '' %>"
        <% } %>
      ><%= contentBlock.title %></h2>
      <% if (user) { %>
        <%-
          include('icon-button', {
            type: 'button',
            className: 'add-card-btn',
            icon: 'plus',
            ariaLabel: `Ajouter une nouvelle carte dans ${contentBlock.title}`,
            dataAttrs: { 'data-block-id': contentBlock.id }
          })
        %>
      <% } %>
    </div>
    
    <div class="cards-grid" role="list" aria-label="<%= sectionLabel %>">
      <% (contentBlock.cards || []).forEach(card => { %>
        <%
          // Construire le style de la carte avec couleurs personnalisées
          const cardStyles = [];
          if (card.bg_color) cardStyles.push(`background-color: ${card.bg_color}`);
          const cardStyleAttr = cardStyles.length > 0 ? `style="${cardStyles.join('; ')}"` : '';
        %>
        <article class="card" data-card-id="<%= card.id %>" role="listitem" <%- cardStyleAttr %>>
          <% if (card.media_path) { %>
            <img 
              src="<%= card.media_path %>" 
              alt="<%= card.title %> - <%= card.description ? card.description.substring(0, 100) : 'Illustration' %>"
              loading="lazy"
            >
          <% } %>
          <h3 
            <% if (card.title_color) { %>
            style="color: <%= card.title_color %>;"
            <% } %>
          ><%= card.title %></h3>
          <% if (card.description) { %>
            <p
              <% 
                const descStyles = [];
                if (card.description_color) descStyles.push(`color: ${card.description_color}`);
                if (card.description_bg_color) descStyles.push(`background-color: ${card.description_bg_color}`, 'padding: 0.75rem', 'border-radius: 4px');
              %>
              <% if (descStyles.length > 0) { %>
              style="<%= descStyles.join('; ') %>;"
              <% } %>
            ><%= card.description %></p>
          <% } %>
          <% if (user) { %>
            <div class="card-controls" role="toolbar" aria-label="Actions pour <%= card.title %>">
              <%-
                include('icon-button', {
                  type: 'button',
                  className: 'edit-card-btn',
                  icon: 'edit',
                  ariaLabel: `Modifier la carte ${card.title}`,
                  dataAttrs: { 'data-card-id': card.id }
                })
              %>
              <%-
                include('icon-button', {
                  type: 'button',
                  className: 'delete-card-btn',
                  icon: 'trash',
                  ariaLabel: `Supprimer la carte ${card.title}`,
                  dataAttrs: { 'data-card-id': card.id }
                })
              %>
            </div>
          <% } %>
        </article>
      <% }) %>
    </div>
  </div>
</section>
