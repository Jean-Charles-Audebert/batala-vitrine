<%
  // Composant Modal de carte
  // Variables attendues: user (pour conditionner l'affichage)
%>

<% if (user) { %>
  <div 
    id="cardModal" 
    class="modal" 
    role="dialog" 
    aria-modal="true"
    aria-labelledby="modalTitle"
    aria-hidden="true"
  >
    <div class="modal-content" role="document">
      <button 
        class="close" 
        type="button"
        data-close-modal="card"
        aria-label="Fermer la fenêtre de modification"
      >&times;</button>
      <h2 id="modalTitle">Ajouter une carte</h2>
      <form id="cardForm">
        <input type="hidden" name="cardId" aria-hidden="true">
        <input type="hidden" name="blockId" aria-hidden="true">
        <div class="form-group">
          <label for="cardTitle">Titre (facultatif)</label>
          <input 
            id="cardTitle" 
            type="text" 
            name="title"
          >
        </div>
        <div class="form-group">
          <label for="cardDescription">Description</label>
          <textarea 
            id="cardDescription" 
            name="description" 
            aria-required="false"
          ></textarea>
        </div>

        <%- include('color-picker', {
          name: 'description_bg_color',
          label: 'Couleur de fond de la description',
          value: '#ffffff',
          helpText: 'Couleur de fond affichée derrière le texte de description.',
          id: 'cardDescriptionBgColor'
        }) %>

        <div class="form-group">
          <label for="cardImage">URL de l'image</label>
          <div class="input-with-button">
            <input 
              id="cardImage" 
              type="text" 
              name="image"
              aria-describedby="cardImageHelp cardImage_status"
            >
            <button 
              type="button" 
              class="btn btn-secondary"
              aria-label="Choisir un fichier image à uploader"
              onclick="document.getElementById('cardImage_file').click()"
            >Choisir une image…</button>
            <input 
              id="cardImage_file" 
              type="file" 
              accept="image/*" 
              data-target-field="cardImage" 
              class="upload-file-input"
            >
          </div>
          <span id="cardImageHelp" class="form-help">Optionnel : URL complète ou chemin relatif (ex: /uploads/xxx.jpg), ou utilisez le bouton pour téléverser.</span>
          <div id="cardImage_status" class="form-status" role="status" aria-live="polite"></div>
        </div>
        <div class="form-group d-none" id="cardImage_preview">
          <label class="sr-only" for="cardImage_preview_img">Aperçu de l'image</label>
          <img id="cardImage_preview_img" src="" alt="Aperçu" class="preview-img-responsive"/>
        </div>
        <button type="submit" aria-label="Enregistrer la carte">Enregistrer</button>
      </form>
    </div>
  </div>
<% } %>
