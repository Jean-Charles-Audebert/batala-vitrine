<div class="toolbar">
  <h1>Gestion des sections</h1>
  <div class="toolbar-actions">
    <button class="btn btn-primary" data-action="new-section">
      <img src="/icons/plus.svg" alt="" class="icon">
      Nouvelle section
    </button>
    <a href="/" class="btn btn-secondary">
      <img src="/icons/home.svg" alt="" class="icon">
      Voir le site
    </a>
  </div>
</div>

<%- include('../partials/alerts') %>

<div class="sections-list">
  <% if (sections.length === 0) { %>
    <div class="empty-state">
      <img src="/icons/sections.svg" alt="" class="empty-icon">
      <h3>Aucune section pour le moment</h3>
      <p>Cr√©ez votre premi√®re section pour commencer √† construire votre site.</p>
      <button class="btn btn-primary" data-action="new-section">
        <img src="/icons/plus.svg" alt="" class="icon">
        Cr√©er ma premi√®re section
      </button>
    </div>
  <% } else { %>
    <table>
      <thead>
        <tr>
          <th>Position</th>
          <th>Type</th>
          <th>Titre</th>
          <th>Visibilit√©</th>
          <th>Layout</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="sections-tbody">
        <% sections.forEach(section => { %>
          <tr data-section-id="<%= section.id %>" draggable="true">
            <td class="drag-handle">
              <span class="position-badge"><%= section.position ?? '‚àû' %></span>
              <span class="drag-icon">‚ãÆ‚ãÆ</span>
            </td>
            <td>
              <span class="type-badge type-<%= section.type %>"><%= section.type.replace('_', ' ') %></span>
            </td>
            <td><%= section.title || 'Sans titre' %></td>
            <td>
              <% if (section.is_visible) { %>
                <span class="badge badge-active">‚úì Visible</span>
              <% } else { %>
                <span class="badge badge-inactive">‚úó Masqu√©</span>
              <% } %>
            </td>
            <td><%= section.layout || '‚Äî' %></td>
            <td>
              <div class="actions">
                <button class="btn btn-sm btn-primary" data-action="edit-section" data-section-id="<%= section.id %>" title="Modifier la section">
                  <img src="/icons/edit.svg" alt="" class="icon">
                </button>
                <% if (section.type === 'card_grid') { %>
                  <button class="btn btn-sm btn-success" data-action="manage-cards" data-section-id="<%= section.id %>" title="G√©rer les cartes">
                    <img src="/icons/palette.svg" alt="" class="icon">
                  </button>
                <% } %>
                <button class="btn btn-sm btn-danger" data-action="delete-section" data-section-id="<%= section.id %>" title="Supprimer la section">
                  <img src="/icons/trash.svg" alt="" class="icon">
                </button>
              </div>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</div>

<!-- Modale S√©lecteur de Vid√©os -->
<div id="videoPickerModal" class="modal" aria-hidden="true">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h2>S√©lectionner une vid√©o</h2>
      <button class="modal-close" data-action="close-video-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div id="videoGrid" class="video-grid">
        <!-- Les vid√©os seront charg√©es ici -->
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-action="close-video-modal">Annuler</button>
      <button type="button" class="btn btn-primary" id="uploadNewVideo">Uploader une nouvelle vid√©o</button>
    </div>
  </div>
</div>

<!-- Modale de gestion des sections -->
<div id="sectionModal" class="modal" aria-hidden="true">
  <div class="modal-content modal-large">
    <div class="modal-header">
      <h2 id="sectionModalTitle">Nouvelle section</h2>
      <button class="modal-close" data-action="close-modal">&times;</button>
    </div>
    <form id="sectionForm">
      <input type="hidden" name="sectionId" id="sectionId">

      <!-- Informations de base -->
      <div class="modal-section">
        <h3>Informations de base</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="sectionType">Type de section *</label>
            <select name="type" id="sectionType" required>
              <option value="hero">üéØ Hero (En-t√™te principal)</option>
              <option value="content">üìù Contenu (Texte + image)</option>
              <option value="card_grid">üé¥ Grille de cartes</option>
              <option value="gallery">üñºÔ∏è Galerie photos/vid√©os</option>
              <option value="footer">üîª Pied de page</option>
            </select>
          </div>

          <div class="form-group">
            <label for="sectionPosition">Position</label>
            <input type="number" name="position" id="sectionPosition" min="0" step="1" placeholder="Auto">
            <small class="form-hint">Laissez vide pour ajouter √† la fin</small>
          </div>
        </div>

        <div class="form-group">
          <label for="sectionTitle">Titre (admin uniquement)</label>
          <input type="text" name="title" id="sectionTitle" placeholder="Label pour identifier la section">
          <small class="form-hint">Ce titre n'est affich√© que dans l'admin. Le contenu visible vient des √©l√©ments de contenu.</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sectionLayout">Layout</label>
            <select name="layout" id="sectionLayout">
              <option value="">‚Äî Par d√©faut ‚Äî</option>
              <option value="centered">Centr√©</option>
              <option value="image_left">Image √† gauche</option>
              <option value="image_right">Image √† droite</option>
              <option value="grid_2">Grille 2 colonnes</option>
              <option value="grid_3">Grille 3 colonnes</option>
              <option value="grid_4">Grille 4 colonnes</option>
            </select>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" name="is_visible" id="sectionVisible" checked>
              Visible sur le site
            </label>
          </div>
        </div>
      </div>

      <!-- Apparence -->
      <div class="modal-section">
        <h3>Apparence</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="sectionBgColor">Couleur de fond</label>
            <div class="color-picker-row">
              <input type="color" id="sectionBgColor" name="bg_color" class="color-input" value="#ffffff">
              <input type="text" class="color-hex-input" value="#ffffff" readonly>
            </div>
          </div>

          <div class="form-group">
            <label for="sectionPaddingTop">Marge haute</label>
            <select name="padding_top" id="sectionPaddingTop">
              <option value="none">Aucune</option>
              <option value="small">Petite</option>
              <option value="medium" selected>Moyenne</option>
              <option value="large">Grande</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sectionPaddingBottom">Marge basse</label>
            <select name="padding_bottom" id="sectionPaddingBottom">
              <option value="none">Aucune</option>
              <option value="small">Petite</option>
              <option value="medium" selected>Moyenne</option>
              <option value="large">Grande</option>
            </select>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" name="is_transparent" id="sectionTransparent">
              Fond transparent
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="sectionBgImage">Image de fond</label>
          <div class="image-upload-field">
            <input type="text" name="bg_image" id="sectionBgImage" placeholder="/uploads/..." readonly>
            <button type="button" class="btn btn-sm btn-secondary" id="selectBgImage">
              <img src="/icons/folder.svg" alt="" class="icon"> Choisir
            </button>
            <button type="button" class="btn btn-sm btn-danger" id="clearBgImage" style="display:none;">
              <img src="/icons/trash.svg" alt="" class="icon">
            </button>
          </div>
          <small class="form-hint">üí° <strong>Tailles recommand√©es pour hero :</strong><br>
          ‚Ä¢ Banni√®re large : 2700√ó600px (ratio 4.5:1) - affichage optimal<br>
          ‚Ä¢ Standard : 1920√ó427px (ratio 4.5:1)<br>
          ‚Ä¢ Minimum : 1350√ó300px (ratio 4.5:1)<br>
          ‚ö†Ô∏è Les images carr√©es ou verticales seront recadr√©es (haut/bas perdus)</small>
        </div>

        <div class="form-group">
          <label for="sectionBgVideo">Vid√©o de fond (MP4)</label>
          <div class="image-upload-field">
            <input type="text" name="bg_video" id="sectionBgVideo" placeholder="/uploads/..." readonly>
            <button type="button" class="btn btn-sm btn-secondary" id="selectBgVideo">
              <img src="/icons/folder.svg" alt="" class="icon"> Choisir
            </button>
            <button type="button" class="btn btn-sm btn-danger" id="clearBgVideo" style="display:none;">
              <img src="/icons/trash.svg" alt="" class="icon">
            </button>
          </div>
          <small class="form-hint">Fichier MP4 local uniquement (max 50 MB)</small>
        </div>

        <div class="form-group">
          <label for="sectionBgYoutube">Vid√©o YouTube</label>
          <input type="text" name="bg_youtube" id="sectionBgYoutube" placeholder="https://youtu.be/... ou https://youtube.com/watch?v=...">
          <small class="form-hint">URL YouTube compl√®te (prioritaire sur MP4 local)</small>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" data-action="close-modal">Annuler</button>
        <button type="submit" class="btn btn-primary">
          <img src="/icons/save.svg" alt="" class="icon"> Enregistrer
        </button>
      </div>
    </form>
  </div>
</div>