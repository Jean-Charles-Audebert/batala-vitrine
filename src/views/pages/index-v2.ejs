<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="<%= pageSettings.title || 'Mon Site' %>">
  <title><%= title %> | <%= pageSettings.title || 'Mon Site' %></title>
  
  <!-- Fonts -->
  <% if (pageSettings.font_url) { %>
    <link rel="stylesheet" href="<%= pageSettings.font_url %>">
  <% } else if (pageSettings.font_file) { %>
    <style>
      @font-face {
        font-family: '<%= pageSettings.font_name %>';
        src: url('<%= pageSettings.font_file %>');
      }
    </style>
  <% } %>
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/design-system.css">
  
  <!-- CSS Variables pour thème -->
  <style>
    :root {
      <% if (pageSettings.font_family) { %>
      --font-family-title: <%= pageSettings.font_family %>;
      <% } %>
      <% if (pageSettings.main_bg_color) { %>
      --main-bg-color: <%= pageSettings.main_bg_color %>;
      <% } %>
      <% if (pageSettings.main_title_color) { %>
      --main-title-color: <%= pageSettings.main_title_color %>;
      <% } %>
    }
    
    <% if (pageSettings.main_bg_image) { %>
    body {
      background-image: url('<%= pageSettings.main_bg_image %>');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
    }
    <% } %>
    
    <% if (pageSettings.main_bg_video) { %>
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: url('<%= pageSettings.main_bg_video %>') no-repeat center center;
      background-size: cover;
    }
    <% } %>
  </style>
</head>
<body class="vitrine-page">
  
  <!-- SECTIONS V2 -->
  <% sections.forEach(section => { %>
    <% if (section.type === 'hero') { %>
      <%- include('../components/sections/hero', { section, user }) %>
      
    <% } else if (section.type === 'content') { %>
      <%- include('../components/sections/content', { section, user }) %>
      
    <% } else if (section.type === 'card_grid') { %>
      <%- include('../components/sections/card_grid', { section, user }) %>
      
    <% } else if (section.type === 'gallery') { %>
      <%- include('../components/sections/gallery', { section, user }) %>
      
    <% } else if (section.type === 'footer') { %>
      <%- include('../components/footer', { 
        contentBlock: {
          id: section.id,
          elements: section.content.map(c => ({
            id: c.id,
            type: c.media_type || 'text',
            parsedContent: {
              about_content: c.description,
              links: c.description ? JSON.parse(c.description).links : []
            }
          }))
        },
        user,
        getSocialIcon
      }) %>
    <% } %>
  <% }) %>
  
  <!-- Scripts -->
  <script src="/js/index.js"></script>
  
  <% if (user) { %>
    <script>
      console.log('Mode admin activé - sections v2');
      // TODO: Ajouter event listeners pour édition sections
    </script>
  <% } %>
</body>
</html>
