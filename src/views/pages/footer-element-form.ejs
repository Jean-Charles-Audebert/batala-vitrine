<%- include('../partials/head', {
  title,
  stylesheets: ['/css/common.css', '/css/admin.css', '/css/buttons.css']
}) %>

<div class="container">
  <div class="admin-toolbar">
    <h1><%= title %></h1>
    <div class="toolbar-actions">
      <a href="/blocks/<%= block.id %>/footer-elements" class="btn btn-secondary">← Annuler</a>
    </div>
  </div>

  <form action="<%= formAction %>" method="POST" class="form">
    <%
      // Parser le contenu existant si élément présent
      let parsedContent = {};
      if (element && element.content) {
        parsedContent = typeof element.content === 'string' ? JSON.parse(element.content) : element.content;
      }
    %>

    <div class="form-group">
      <label for="type">Type d'élément *</label>
      <select id="type" name="type" class="form-control" required <%= element ? 'disabled' : '' %>>
        <option value="">-- Sélectionnez un type --</option>
        <option value="text" <%= element && element.type === 'text' ? 'selected' : '' %>>Texte (À propos)</option>
        <option value="contact" <%= element && element.type === 'contact' ? 'selected' : '' %>>Contact</option>
        <option value="social" <%= element && element.type === 'social' ? 'selected' : '' %>>Réseaux sociaux</option>
        <option value="link" <%= element && element.type === 'link' ? 'selected' : '' %>>Lien externe</option>
      </select>
      <% if (element) { %>
        <input type="hidden" name="type" value="<%= element.type %>">
      <% } %>
      <small class="form-text">Choisissez le type d'élément à afficher dans le footer.</small>
    </div>

    <!-- Champs pour type "text" (À propos) -->
    <div id="text-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Contenu À propos</h3>
      <div class="form-group">
        <label for="about_content">Description *</label>
        <textarea id="about_content" name="about_content" class="form-control" rows="5" required><%= parsedContent.about_content || '' %></textarea>
        <small class="form-text">Texte de présentation de votre organisation.</small>
      </div>
    </div>

    <!-- Champs pour type "contact" -->
    <div id="contact-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Informations de contact</h3>
      <div class="form-group">
        <label for="contact_phone">Téléphone</label>
        <input type="tel" id="contact_phone" name="contact_phone" class="form-control" 
               value="<%= parsedContent.phone || '' %>" placeholder="+33 6 12 34 56 78">
      </div>
      <div class="form-group">
        <label for="contact_email">Email</label>
        <input type="email" id="contact_email" name="contact_email" class="form-control" 
               value="<%= parsedContent.email || '' %>" placeholder="contact@example.fr">
      </div>
      <div class="form-group">
        <label for="contact_address">Adresse</label>
        <textarea id="contact_address" name="contact_address" class="form-control" rows="3" placeholder="1 Rue Example, 17000 Ville"><%= parsedContent.address || '' %></textarea>
      </div>
    </div>

    <!-- Champs pour type "social" -->
    <div id="social-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Réseau social</h3>
      <div class="form-group">
        <label for="social_network">Plateforme *</label>
        <select id="social_network" name="social_network" class="form-control" required>
          <option value="">-- Sélectionnez une plateforme --</option>
          <% availableNetworks.forEach(network => { %>
            <%
              const selectedNetwork = parsedContent.links && parsedContent.links[0] ? parsedContent.links[0].network || parsedContent.links[0].platform : '';
            %>
            <option value="<%= network.id %>" <%= selectedNetwork === network.id ? 'selected' : '' %>><%= network.name %></option>
          <% }); %>
        </select>
      </div>
      <div class="form-group">
        <label for="social_url">URL *</label>
        <input type="url" id="social_url" name="social_url" class="form-control" required
               value="<%= parsedContent.links && parsedContent.links[0] ? parsedContent.links[0].url : '' %>" placeholder="https://...">
      </div>
    </div>

    <!-- Champs pour type "link" (Lien externe) -->
    <div id="link-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Lien externe</h3>
      <div class="form-group">
        <label for="link_label">Libellé *</label>
        <input type="text" id="link_label" name="link_label" class="form-control" required
               value="<%= parsedContent.label || parsedContent.title || '' %>" placeholder="Partenaire, Ressource...">
      </div>
      <div class="form-group">
        <label for="link_url">URL *</label>
        <input type="url" id="link_url" name="link_url" class="form-control" required
               value="<%= parsedContent.url || '' %>" placeholder="https://...">
      </div>
    </div>

    <button type="submit" class="btn btn-primary" style="margin-top: 2rem;">
      <%= element ? 'Mettre à jour' : 'Créer' %>
    </button>
  </form>
</div>

<%- include('../partials/footer', { scripts: ['/js/footer-element-form.js'] }) %>
