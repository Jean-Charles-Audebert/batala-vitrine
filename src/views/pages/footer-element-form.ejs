<%- include('../partials/head', {
  title,
  stylesheets: ['/css/common.css', '/css/admin.css']
}) %>

<div class="container">
  <div class="admin-toolbar">
    <h1><%= title %></h1>
    <div class="toolbar-actions">
      <a href="/blocks/<%= block.id %>/footer-elements" class="btn btn-secondary">← Annuler</a>
    </div>
  </div>

  <form action="<%= formAction %>" method="POST" class="form">
    <div class="form-group">
      <label for="type">Type d'élément *</label>
      <select id="type" name="type" class="form-control" required>
        <option value="">-- Sélectionnez un type --</option>
        <option value="text" <%= element && element.type === 'text' ? 'selected' : '' %>>Texte (À propos)</option>
        <option value="contact" <%= element && element.type === 'contact' ? 'selected' : '' %>>Contact</option>
        <option value="social" <%= element && element.type === 'social' ? 'selected' : '' %>>Réseaux sociaux</option>
      </select>
      <small class="form-text">Choisissez le type d'élément à afficher dans le footer.</small>
    </div>

    <!-- Champs pour type "text" (À propos) -->
    <div id="text-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Contenu texte</h3>
      <div class="form-group">
        <label for="text_title">Titre</label>
        <input type="text" id="text_title" name="text_title" class="form-control" 
               value="<%= element && element.type === 'text' && element.content.title ? element.content.title : '' %>">
      </div>
      <div class="form-group">
        <label for="text_content">Texte</label>
        <textarea id="text_content" name="text_content" class="form-control" rows="5"><%= element && element.type === 'text' && element.content.text ? element.content.text : '' %></textarea>
      </div>
    </div>

    <!-- Champs pour type "contact" -->
    <div id="contact-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Informations de contact</h3>
      <div class="form-group">
        <label for="contact_title">Titre</label>
        <input type="text" id="contact_title" name="contact_title" class="form-control" 
               value="<%= element && element.type === 'contact' && element.content.title ? element.content.title : '' %>">
      </div>
      <div class="form-group">
        <label for="contact_email">Email</label>
        <input type="email" id="contact_email" name="contact_email" class="form-control" 
               value="<%= element && element.type === 'contact' && element.content.email ? element.content.email : '' %>">
      </div>
      <div class="form-group">
        <label for="contact_phone">Téléphone</label>
        <input type="tel" id="contact_phone" name="contact_phone" class="form-control" 
               value="<%= element && element.type === 'contact' && element.content.phone ? element.content.phone : '' %>">
      </div>
      <div class="form-group">
        <label for="contact_address">Adresse</label>
        <textarea id="contact_address" name="contact_address" class="form-control" rows="3"><%= element && element.type === 'contact' && element.content.address ? element.content.address : '' %></textarea>
      </div>
    </div>

    <!-- Champs pour type "social" -->
    <div id="social-fields" class="type-fields" style="display: none;">
      <h3 class="mt-3">Réseaux sociaux</h3>
      <div class="form-group">
        <label for="social_title">Titre</label>
        <input type="text" id="social_title" name="social_title" class="form-control" 
               value="<%= element && element.type === 'social' && element.content.title ? element.content.title : '' %>">
      </div>
      
      <div id="social-links-container">
        <label>Liens sociaux</label>
        <% if (element && element.type === 'social' && element.content.links && element.content.links.length > 0) { %>
          <% element.content.links.forEach((link, index) => { %>
            <div class="social-link-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
              <select name="social_platform" class="form-control social-select" style="flex: 1;">
                <option value="">-- Plateforme --</option>
                <% availableNetworks.forEach(network => { %>
                  <option value="<%= network.id %>" data-icon="<%= network.icon %>" <%= link.platform === network.id ? 'selected' : '' %>>
                    <%= network.name %>
                  </option>
                <% }); %>
              </select>
              <img class="social-icon-preview" src="<%= availableNetworks.find(n => n.id === link.platform)?.icon || '' %>" alt="" style="width: 24px; height: 24px; display: <%= link.platform ? 'block' : 'none' %>;">
              <input type="url" name="social_url" class="form-control" style="flex: 2;" placeholder="https://..." value="<%= link.url %>">
              <button type="button" class="btn btn-danger btn-sm remove-social-link">×</button>
            </div>
          <% }); %>
        <% } else { %>
          <div class="social-link-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; align-items: center;">
            <select name="social_platform" class="form-control social-select" style="flex: 1;">
              <option value="">-- Plateforme --</option>
              <% availableNetworks.forEach(network => { %>
                <option value="<%= network.id %>" data-icon="<%= network.icon %>"><%= network.name %></option>
              <% }); %>
            </select>
            <img class="social-icon-preview" src="" alt="" style="width: 24px; height: 24px; display: none;">
            <input type="url" name="social_url" class="form-control" style="flex: 2;" placeholder="https://...">
            <button type="button" class="btn btn-danger btn-sm remove-social-link">×</button>
          </div>
        <% } %>
      </div>
      <button type="button" id="add-social-link" class="btn btn-secondary btn-sm mt-2">+ Ajouter un lien</button>
    </div>

    <button type="submit" class="btn btn-primary" style="margin-top: 2rem;">
      <%= element ? 'Mettre à jour' : 'Créer' %>
    </button>
  </form>
</div>

<%- include('../partials/footer', { scripts: ['/js/footer-element-form.js'] }) %>
